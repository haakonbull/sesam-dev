{
  "_id": "apply-hops-testing",
  "type": "pipe",
  "source": {
    "type": "dataset",
    "dataset": "global-person"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["add", "foo", "bar"],
        ["copy", "_id"],
        ["comment", "Copying the zipcode is not needed. We have done it in this example to display which postalcode the data is from."],
        ["copy", "global-person:zipcode"],
        ["add", "result_from_hops",
          ["hops", {
            "datasets": ["global-person gp"],
            "where": ["eq", "_S.erp-person:Gender", "gp.erp-person:Gender"]
          }]
        ],
        ["merge-union",
          ["apply-hops", "rule1", {
            "datasets": ["global-person gp"],
            "where": ["eq", "_S.erp-person:Gender", "gp.erp-person:Gender"]
          }]
        ]
      ],
      "rule1": [
        ["add", "list_of_id", "_S._id"]
      ]
    }
  }
}
