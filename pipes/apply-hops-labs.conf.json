{
  "_id": "apply-hops-labs",
  "type": "pipe",
  "source": {
    "type": "dataset",
    "dataset": "global-person"
  },
  "transform": {
    "type": "dtl",
    "rules": {
      "default": [
        ["copy", "_id"],
        ["comment", "Copying the zipcode is not needed. We have done it in this example to display which postalcode the data is from."],
        ["copy", "global-person:zipcode"],
        ["merge",
          ["apply-hops", "city-location", {
            "datasets": ["global-location gl"],
            "where": ["eq", "_S.global-person:zipcode", "gl.udir-postalcode:postalcode"]
          }]
        ]
      ],
      "city-location": [
        ["add", "location",
          ["concat", "_S.city", " is located in municipality number ", "_S.municipality"]
        ],
        ["add", "testerutnoe", "_S.municipality-ni"],
        ["merge",
          ["apply-hops", "latitude-check", {
            "datasets": ["global-location gl"],
            "where": ["eq", "_S.municipality-ni", "gl.$ids"]
          }]
        ],
        ["add", "foo", "bar"]
      ],
      "latitude-check": [
        ["add", "arctic-municipality",
          ["if",
            ["gte",
              ["last", "_S.punktIOmrade.coordinates"], "~f66.33"], true, false]
        ]
      ]
    }
  }
}
